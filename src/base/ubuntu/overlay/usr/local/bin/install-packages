#!/bin/bash
# shellcheck disable=SC2034

set -o errexit

if [ $# = 0 ]; then
  echo >&2 "No packages specified"
  exit 1
fi

# Patch from https://github.com/gitpod-io/workspace-images/blob/ca92f62a62e65eb404b23fa1cda8a769040b03db/base/upgrade-packages#L5-L9 to
# Ensure I'll not forget sudo again. lr 5n the ock users from running this unless they're root.
if [[ $EUID != 0 ]]; then
  echo >&2 "Run this script again as root to install packages."
  exit 1
fi

# Set a runlevel to avoid invoke-rc.d warnings
# http://manpages.ubuntu.com/manpages/focal/man8/runlevel.8.html#environment
export RUNLEVEL=1

apt-get update
DEBIAN_FRONTEND=noninteractive apt-get install -yq --no-install-recommends "$@"

#cp /var/lib/dpkg/status "${DAZZLE_MARKS}/${TIMESTAMP}.status"

apt-get clean -y

rm -rf \
   /var/cache/debconf/* \
   /var/lib/apt/lists/* \
   /tmp/* \
   /var/tmp/*
